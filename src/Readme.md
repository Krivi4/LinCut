# LinCut

**URL‚Äëshortener –Ω–∞ Spring¬†Boot + PostgreSQL + pg\_cron**

–°–µ—Ä–≤–∏—Å —Å–æ–∫—Ä–∞—â–∞–µ—Ç –¥–ª–∏–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏ —Ö—Ä–∞–Ω–∏—Ç –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ `url`.  –†–∞–∑ –≤ **2¬†–º–∏–Ω—É—Ç—ã** —Ñ–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä `pg_cron` —É–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö `expires_date` –º–µ–Ω—å—à–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏¬†‚Äî –±–∞–∑–∞ –Ω–µ —Ä–∞–∑—Ä–∞—Å—Ç–∞–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.

---

## ‚öôÔ∏è¬†–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

- **Docker¬†Engine¬†‚â•¬†20.10** –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–ª–∞–≥–∏–Ω Compose¬†v2\
  (–≤ Linux —Å—Ç–∞–≤–∏—Ç—Å—è –ø–∞–∫–µ—Ç–∞–º–∏ `docker-ce docker-compose-plugin`, –∞ –≤¬†Windows / macOS –≤—Ö–æ–¥–∏—Ç –≤ Docker¬†Desktop).

–ù–∏–∫–∞–∫–∏—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö PostgreSQL, Node¬†JS, Java¬†‚Äî –∫—Ä–æ–º–µ JDK¬†17 –¥–ª—è —Å–∞–º–æ–≥–æ Spring‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è¬†‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –Ω–µ –ø—Ä–∏–¥—ë—Ç—Å—è.

---

## üöÄ¬†–ó–∞–ø—É—Å–∫ –≤¬†—Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
$ git clone https://github.com/<your‚Äëorg>/LinCut.git
$ cd LinCut

# 2. –ü–æ–¥–Ω–∏–º–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Postgres + pg_cron (–ø–æ—Ä—Ç 5432 –≤–Ω—É—Ç—Ä–∏, 5433 —Å–Ω–∞—Ä—É–∂–∏)
$ docker compose up -d db

# 3. –ó–∞–ø—É—Å–∫–∞–µ–º Spring Boot‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
$ ./mvnw spring-boot:run              # –∏–ª–∏ ./gradlew bootRun
```

–ß–µ—Ä–µ–∑ –ø–∞—Ä—É –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ `cron.job_run_details` —É–∂–µ –±—É–¥—É—Ç –∑–∞–ø–∏—Å–∏ —Å–æ¬†`status = succeeded`¬†‚Äî –∑–Ω–∞—á–∏—Ç –∞–≤—Ç–æ‚Äë–æ—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç.

> **–í–∞–∂–Ω–æ!** –ï—Å–ª–∏ —É –≤–∞—Å –Ω–∞ –º–∞—à–∏–Ω–µ —É–∂–µ –∑–∞–ø—É—â–µ–Ω ¬´—Ä–æ–¥–Ω–æ–π¬ª PostgreSQL –∏ –∑–∞–Ω–∏–º–∞–µ—Ç¬†5432, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ä–∞–∑—É —Å—Ç–∞—Ä—Ç—É–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞—Ä—É–∂—É –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è **5433**.  –ù—É–∂–µ–Ω –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç¬†‚Äî –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `HOST_DB_PORT` (—Å–º.¬†–Ω–∏–∂–µ).

---

## üîç¬†–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å—ë –æ–∫

```bash
# –≤—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π
$ docker compose exec db \
    psql -U postgres -d lincut_db \
    -c "SELECT jobid, schedule, nodename FROM cron.job;"

# —Å–º–æ—Ç—Ä–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏ –∑–∞–¥–∞—á–∏
$ docker compose exec db \
    psql -U postgres -d lincut_db \
    -c "SELECT runid, status, return_message FROM cron.job_run_details ORDER BY runid DESC LIMIT 5;"
```

–ö–∞–∂–¥—ã–µ –¥–≤–µ –º–∏–Ω—É—Ç—ã –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ `status = succeeded`.

---

## ‚öôÔ∏è¬†–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è          | –ü–æ‚Äë—É–º–æ–ª—á–∞–Ω–∏—é | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                 |
| ------------------- | ------------ | ------------------------------------------ |
| `HOST_DB_PORT`      | **5433**     | –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º PostgreSQL –≤–∏–¥–µ–Ω –Ω–∞ —Ö–æ—Å—Ç–µ |
| `POSTGRES_PASSWORD` | **postgres** | –ü–∞—Ä–æ–ª—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ      |

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –ø–æ—Ä—Ç—É 5555:

```bash
HOST_DB_PORT=5555 docker compose up -d db
```

---

## üóÇÔ∏è¬†–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
LinCut/
‚îú‚îÄ‚îÄ docker-compose.yml          # —Å–µ—Ä–≤–∏—Å db (Postgres + pg_cron)
‚îú‚îÄ‚îÄ postgres/
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ initdb/                 # SQL‚Äë—Å–∫—Ä–∏–ø—Ç—ã, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è 1‚Äë–π —Ä–∞–∑
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ 010_create_extensions.sql   # CREATE EXTENSION pg_cron;
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ 020_schedule_jobs.sql       # cron.schedule('delete_expired_urls', ‚Ä¶)
‚îú‚îÄ‚îÄ src/                         # –∫–æ–¥ Spring Boot‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md
```

---

## üõ†Ô∏è¬†–ö–∞–∫ —ç—Ç–æ —É—Å—Ç—Ä–æ–µ–Ω–æ

- **`shared_preload_libraries=pg_cron`** –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `cron.database_name=lincut_db` –∑–∞–¥–∞—é—Ç—Å—è –ø—Ä—è–º–æ –≤ `command:` docker‚Äë–∫–æ–º–ø–æ–∑–∞.
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Postgres –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ `.sql`‚Äë—Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `postgres/initdb/`:
    - `010_create_extensions.sql`¬†‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ;
    - `020_schedule_jobs.sql`¬†‚Äî –≤–Ω–æ—Å–∏—Ç –∑–∞–¥–∞—á—É `delete_expired_urls` –∏ —Å—Ä–∞–∑—É –æ–±–Ω—É–ª—è–µ—Ç `nodename`, —á—Ç–æ–±—ã –≤–æ—Ä–∫–µ—Ä –ø–æ–¥–∫–ª—é—á–∞–ª—Å—è –∫¬†–±–∞–∑–µ —á–µ—Ä–µ–∑ Unix‚Äë—Å–æ–∫–µ—Ç.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –Ω–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ—Å–ª–µ `git clone` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚Äî –±–∞–∑–∞, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏ –∫—Ä–æ–Ω‚Äë–∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

##
